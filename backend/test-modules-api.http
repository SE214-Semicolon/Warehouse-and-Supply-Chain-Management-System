### ============================================
### TEST API - Auth, Supplier, PO, SO Modules
### ============================================
### Prerequisites: npm run start:dev + seed data loaded
### Tool: REST Client extension for VSCode

@baseUrl = http://localhost:3000
@adminToken = {{login.response.body.accessToken}}

### ============================================
### 1. AUTH MODULE
### ============================================

### 1.1 Login as Admin
# @name login
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "admin@warehouse.com",
  "password": "admin123"
}

### 1.2 Create Invite Token (admin only)
POST {{baseUrl}}/invites
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "email": "newuser@example.com",
  "role": "warehouse_staff",
  "expiryDays": 7
}

### 1.3 List Invites
GET {{baseUrl}}/invites?page=1&pageSize=10
Authorization: Bearer {{adminToken}}

### 1.4 Signup with Invite Token (replace token)
POST {{baseUrl}}/auth/signup
Content-Type: application/json

{
  "email": "newuser@example.com",
  "password": "password123",
  "fullName": "New User",
  "inviteToken": "inv-REPLACE_WITH_TOKEN_FROM_1.2"
}


### ============================================
### 2. SUPPLIER MODULE
### ============================================

### 2.1 List Suppliers
GET {{baseUrl}}/suppliers?page=1&pageSize=10
Authorization: Bearer {{adminToken}}

### 2.2 Get Supplier Detail
GET {{baseUrl}}/suppliers/REPLACE_WITH_SUPPLIER_ID
Authorization: Bearer {{adminToken}}

### 2.3 Create New Supplier
POST {{baseUrl}}/suppliers
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "code": "SUP-TEST",
  "name": "Test Supplier Co.",
  "contactInfo": {
    "email": "contact@testsup.com",
    "phone": "+84905555555",
    "contactPerson": "John Doe"
  },
  "address": "123 Test Street, Test City"
}

### 2.4 Update Supplier
PATCH {{baseUrl}}/suppliers/REPLACE_WITH_SUPPLIER_ID
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "name": "Updated Supplier Name",
  "contactInfo": {
    "email": "newemail@testsup.com",
    "phone": "+84906666666"
  }
}

### 2.5 Search Suppliers by Name
GET {{baseUrl}}/suppliers?q=Electronics
Authorization: Bearer {{adminToken}}


### ============================================
### 3. PURCHASE ORDER MODULE
### ============================================

### 3.1 List Purchase Orders
GET {{baseUrl}}/purchase-orders?page=1&pageSize=10
Authorization: Bearer {{adminToken}}

### 3.2 Get PO Detail
GET {{baseUrl}}/purchase-orders/REPLACE_WITH_PO_ID
Authorization: Bearer {{adminToken}}

### 3.3 Create Draft PO
# @name createPO
POST {{baseUrl}}/purchase-orders
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "supplierId": "REPLACE_WITH_SUPPLIER_ID",
  "placedAt": "2024-12-05T10:00:00Z",
  "expectedArrival": "2024-12-15T10:00:00Z",
  "notes": "Test PO from API",
  "items": [
    {
      "productId": "REPLACE_WITH_PRODUCT_ID",
      "qtyOrdered": 10,
      "unitPrice": 50000,
      "remark": "Test item"
    }
  ]
}

### 3.4 Submit PO (draft -> ordered)
POST {{baseUrl}}/purchase-orders/REPLACE_WITH_PO_ID/submit
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "userId": "REPLACE_WITH_USER_ID"
}

### 3.5 Receive PO (partial)
POST {{baseUrl}}/purchase-orders/REPLACE_WITH_PO_ID/receive
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "items": [
    {
      "poItemId": "REPLACE_WITH_PO_ITEM_ID",
      "productBatchId": "REPLACE_WITH_BATCH_ID",
      "locationId": "REPLACE_WITH_LOCATION_ID",
      "qtyToReceive": 5,
      "createdById": "REPLACE_WITH_USER_ID",
      "idempotencyKey": "test-receive-001"
    }
  ]
}

### 3.6 Add Items to Draft PO
POST {{baseUrl}}/purchase-orders/REPLACE_WITH_PO_ID/items
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "items": [
    {
      "productId": "REPLACE_WITH_PRODUCT_ID",
      "qtyOrdered": 5,
      "unitPrice": 30000
    }
  ]
}

### 3.7 Cancel PO
POST {{baseUrl}}/purchase-orders/REPLACE_WITH_PO_ID/cancel
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{}


### ============================================
### 4. SALES ORDER MODULE
### ============================================

### 4.1 List Sales Orders
GET {{baseUrl}}/sales-orders?page=1&pageSize=10
Authorization: Bearer {{adminToken}}

### 4.2 Get SO Detail
GET {{baseUrl}}/sales-orders/REPLACE_WITH_SO_ID
Authorization: Bearer {{adminToken}}

### 4.3 Create SO
# @name createSO
POST {{baseUrl}}/sales-orders
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "customerId": "REPLACE_WITH_CUSTOMER_ID",
  "placedAt": "2024-12-05T10:00:00Z",
  "items": [
    {
      "productId": "REPLACE_WITH_PRODUCT_ID",
      "productBatchId": "REPLACE_WITH_BATCH_ID",
      "qty": 3,
      "unitPrice": 60000
    }
  ]
}

### 4.4 Submit SO (pending -> approved)
POST {{baseUrl}}/sales-orders/REPLACE_WITH_SO_ID/submit
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "userId": "REPLACE_WITH_USER_ID"
}

### 4.5 Fulfill SO (dispatch inventory)
POST {{baseUrl}}/sales-orders/REPLACE_WITH_SO_ID/fulfill
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "items": [
    {
      "soItemId": "REPLACE_WITH_SO_ITEM_ID",
      "productBatchId": "REPLACE_WITH_BATCH_ID",
      "locationId": "REPLACE_WITH_LOCATION_ID",
      "qtyToFulfill": 2,
      "createdById": "REPLACE_WITH_USER_ID",
      "idempotencyKey": "test-fulfill-001"
    }
  ]
}

### 4.6 Update Pending SO
PATCH {{baseUrl}}/sales-orders/REPLACE_WITH_SO_ID
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "placedAt": "2024-12-06T10:00:00Z",
  "items": [
    {
      "id": "REPLACE_WITH_SO_ITEM_ID",
      "qty": 5,
      "unitPrice": 55000
    }
  ]
}

### 4.7 Cancel SO
POST {{baseUrl}}/sales-orders/REPLACE_WITH_SO_ID/cancel
Authorization: Bearer {{adminToken}}


### ============================================
### 5. QUICK TEST FLOWS (Using Seed Data)
### ============================================

### 5.1 Login as Manager
# @name managerLogin
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "manager@warehouse.com",
  "password": "manager123"
}

### 5.2 List Seeded Suppliers
GET {{baseUrl}}/suppliers
Authorization: Bearer {{managerLogin.response.body.accessToken}}

### 5.3 List Seeded POs
GET {{baseUrl}}/purchase-orders
Authorization: Bearer {{managerLogin.response.body.accessToken}}

### 5.4 List Seeded SOs
GET {{baseUrl}}/sales-orders
Authorization: Bearer {{managerLogin.response.body.accessToken}}

### 5.5 Get Pending SO (SO-202410-001)
GET {{baseUrl}}/sales-orders?soNo=SO-202410-001
Authorization: Bearer {{managerLogin.response.body.accessToken}}

### 5.6 Get Partial PO (PO-202410-002)
GET {{baseUrl}}/purchase-orders?poNo=PO-202410-002
Authorization: Bearer {{managerLogin.response.body.accessToken}}


### ============================================
### NOTES
### ============================================
# 1. Replace REPLACE_WITH_* placeholders with actual IDs from seed data or API responses
# 2. Use VSCode REST Client extension to run these tests
# 3. Token auto-refresh: Use {{login.response.body.accessToken}} syntax
# 4. For idempotency keys, use unique values to test idempotent operations
# 5. Check status transitions:
#    PO: draft -> ordered -> partial -> received
#    SO: pending -> approved -> processing -> shipped

